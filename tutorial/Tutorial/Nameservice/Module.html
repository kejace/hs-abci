<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Nameservice - Module - </title> <link rel="shortcut icon" href="/hs-abci/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/hs-abci/assets/css/just-the-docs.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-5555555-55"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', "UA-5555555-55"); </script> <script type="text/javascript" src="/hs-abci/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/hs-abci/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Nameservice - Module</title> <meta name="generator" content="Jekyll v3.8.6" /> <meta property="og:title" content="Nameservice - Module" /> <meta property="og:locale" content="en_US" /> <script type="application/ld+json"> {"headline":"Nameservice - Module","@type":"WebPage","url":"/hs-abci/tutorial/Tutorial/Nameservice/Module.html","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="link" viewBox="0 0 16 16"> <title>Link</title> <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path> </symbol> </svg> <div class="page-wrap"> <div class="side-bar"> <div class="site-header"> <a href="hs-abci" class="site-title lh-tight"> </a> <button class="menu-button fs-3 js-main-nav-trigger" data-text-toggle="Hide" type="button">Menu</button> </div> <div class="navigation main-nav js-main-nav"> <nav role="navigation" aria-label="Main navigation"> <ul class="navigation-list"><li class="navigation-list-item"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Application.html" class="navigation-list-link">Nameservice - Application</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Foundations/BaseApp.html" class="navigation-list-link">Foundations - BaseApp</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Keeper.html" class="navigation-list-link">Nameservice - Keeper</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Message.html" class="navigation-list-link">Nameservice - Message</a></li><li class="navigation-list-item active"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Module.html" class="navigation-list-link active">Nameservice - Module</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Foundations/Modules.html" class="navigation-list-link">Foundations - Modules</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Foundations/Overview.html" class="navigation-list-link">tutorial</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Overview.html" class="navigation-list-link">tutorial</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Query.html" class="navigation-list-link">Nameservice - Query</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/README.html" class="navigation-list-link">Tutorial</a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/Tutorial/Nameservice/Types.html" class="navigation-list-link">Nameservice - Types</a></li><li class="navigation-list-item active"><a href="/hs-abci/" class="navigation-list-link"></a></li><li class="navigation-list-item"><a href="/hs-abci/tutorial/" class="navigation-list-link">Tutorial</a></li><li class="navigation-list-item"><a href="/hs-abci/" class="navigation-list-link">hs-abci</a></li></ul> </nav> </div> <footer class="site-footer"> <p class="text-small text-grey-dk-000 mb-4">This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</p> </footer> </div> <div class="main-content-wrap js-main-content" tabindex="0"> <div class="main-content"> <div class="page-header js-page-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" class="js-search-input search-input" tabindex="0" placeholder="Search " aria-label="Search " autocomplete="off"> <svg width="14" height="14" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" class="search-icon"><title>Search</title><g fill-rule="nonzero"><path d="M17.332 20.735c-5.537 0-10-4.6-10-10.247 0-5.646 4.463-10.247 10-10.247 5.536 0 10 4.601 10 10.247s-4.464 10.247-10 10.247zm0-4c3.3 0 6-2.783 6-6.247 0-3.463-2.7-6.247-6-6.247s-6 2.784-6 6.247c0 3.464 2.7 6.247 6 6.247z"/><path d="M11.672 13.791L.192 25.271 3.02 28.1 14.5 16.62z"/></g></svg> </div> <div class="js-search-results search-results-wrap"></div> </div> <ul class="list-style-none text-small aux-nav"> <li class="d-inline-block my-0"><a href="//github.com/f-o-a-m/hs-abci">GitHub project</a></li> </ul> </div> <div class="page"> <div id="main-content" class="page-content" role="main"> <h1 id="module"> <a href="#module" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Module </h1> <h2 id="tutorial.nameservice.module"> <a href="#tutorial.nameservice.module" class="anchor-heading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#link"></use></svg></a> Tutorial.Nameservice.Module </h2> <p>At this point we can collect the relevant pieces to form the Nameservice module:</p> <div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="kw">module</span> <span class="dt">Tutorial.Nameservice.Module</span> <span class="kw">where</span>

<span class="kw">import </span><span class="dt">Nameservice.Modules.Nameservice.Keeper</span> (<span class="dt">NameserviceEffs</span>, eval)
<span class="kw">import </span><span class="dt">Nameservice.Modules.Nameservice.Messages</span> (<span class="dt">NameserviceMessage</span>)
<span class="kw">import </span><span class="dt">Nameservice.Modules.Nameservice.Query</span> (<span class="dt">Api</span>, server)
<span class="kw">import </span><span class="dt">Nameservice.Modules.Nameservice.Router</span> (router)
<span class="kw">import </span><span class="dt">Nameservice.Modules.Nameservice.Types</span> (<span class="dt">NameserviceModuleName</span>)
<span class="kw">import </span><span class="dt">Nameservice.Modules.Token</span>                (<span class="dt">TokenEffs</span>)
<span class="kw">import </span><span class="dt">Polysemy</span>                                 (<span class="dt">Members</span>)
<span class="kw">import </span><span class="dt">Tendermint.SDK.Application</span>               (<span class="dt">Module</span> (..),
                                                 defaultTxChecker)
<span class="kw">import </span><span class="dt">Tendermint.SDK.BaseApp</span>                   (<span class="dt">BaseAppEffs</span>)

<span class="co">-- a convenient type alias</span>
<span class="kw">type</span> <span class="dt">NameserviceM</span> r <span class="fu">=</span>
  <span class="dt">Module</span> <span class="dt">NameserviceModuleName</span> <span class="dt">NameserviceMessage</span> () <span class="dt">Api</span> <span class="dt">NameserviceEffs</span> r

nameserviceModule
<span class="ot">  ::</span> <span class="dt">Members</span> <span class="dt">BaseAppEffs</span> r
  <span class="ot">=&gt;</span> <span class="dt">Members</span> <span class="dt">TokenEffs</span> r
  <span class="ot">=&gt;</span> <span class="dt">Members</span> <span class="dt">NameserviceEffs</span> r
  <span class="ot">=&gt;</span> <span class="dt">NameserviceM</span> r
nameserviceModule <span class="fu">=</span> <span class="dt">Module</span>
  { moduleTxDeliverer <span class="fu">=</span> router
  , moduleTxChecker <span class="fu">=</span> defaultTxChecker
  , moduleQueryServer <span class="fu">=</span> server
  , moduleEval <span class="fu">=</span> eval
  }</code></pre></div> <p>We are using <code>defaultTxChecker</code> as our transaction checker, which is a static message validator defined as</p> <div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">defaultTxChecker
<span class="ot">  ::</span> <span class="dt">Member</span> (<span class="dt">Error</span> <span class="dt">AppError</span>) r
  <span class="ot">=&gt;</span> <span class="dt">ValidateMessage</span> msg
  <span class="ot">=&gt;</span> <span class="dt">RoutedTx</span> msg
  <span class="ot">-&gt;</span> <span class="dt">Sem</span> r ()
defaultTxChecker (<span class="dt">RoutedTx</span> <span class="dt">Tx</span>{txMsg}) <span class="fu">=</span>
  <span class="kw">case</span> validateMessage txMsg <span class="kw">of</span>
    <span class="dt">V.Failure</span> err <span class="ot">-&gt;</span>
      throwSDKError <span class="fu">.</span> <span class="dt">MessageValidation</span> <span class="fu">.</span> map formatMessageSemanticError <span class="fu">$</span> err
    <span class="dt">V.Success</span> _ <span class="ot">-&gt;</span> pure ()</code></pre></div> <p>This means that we are only doing static validation, meaning that we're not interested in checking message validitity against the database. This is reflected in the return type for the checker <code>Sem r ()</code>. If you want to add custom checking, you may write a custom checker for your module.</p> <p>Note the constraints on the module's effects <code>r</code>:</p> <div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">...</span>
<span class="ot">  ::</span> <span class="dt">Members</span> <span class="dt">BaseAppEffs</span> r
  <span class="ot">=&gt;</span> <span class="dt">Members</span> <span class="dt">TokenEffs</span> r
  <span class="ot">=&gt;</span> <span class="dt">Members</span> <span class="dt">NameserviceEffs</span> r
<span class="fu">...</span></code></pre></div> <p>This is saying that we can run this module in any context for which <code>r</code> has the effects from <code>BaseApp</code>, <code>Token</code>, and <code>Nameservice</code>. This is how we explicitly declare module dependencies, by using the constraint system.</p> <p>Other than that, there is nothing really to note. We are just collecting the pieces we have already defined in one place.</p> <p><a href="Application.md">Next: Application</a></p> </div> </div> </div> </div> </body> </html>
