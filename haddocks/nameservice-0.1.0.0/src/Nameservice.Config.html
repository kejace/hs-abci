<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Nameservice.Config</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier hs-type">AppConfig</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Nameservice.Config.html#baseAppContext"><span class="hs-identifier hs-var">baseAppContext</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Nameservice.Config.html#prometheusServerThreadId"><span class="hs-identifier hs-var">prometheusServerThreadId</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Nameservice.Config.html#makeAppConfig"><span class="hs-identifier hs-var">makeAppConfig</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Concurrent</span><span>                        </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ThreadId</span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Error</span><span>                             </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MaybeT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>                                                            </span><span class="hs-identifier hs-var">runMaybeT</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens</span><span>                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">makeLenses</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>                                                            </span><span class="hs-special">(</span><span class="hs-operator hs-var">.~</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">^.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.IORef</span><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IORef</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span>                                </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.String.Conversions</span><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">cs</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Database.V5.Bloodhound</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BH</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Katip</span><span>                                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">K</span><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Katip.Scribes.ElasticSearch</span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ES</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Network.HTTP.Client</span><span>                       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Client</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.Environment</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">System.IO</span><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">stdout</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Tendermint.SDK.BaseApp</span><span>                    </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BaseApp</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Tendermint.SDK.BaseApp.Logger.Katip</span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">KL</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Tendermint.SDK.BaseApp.Metrics.Prometheus</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">P</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text.Read</span><span>                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">read</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">data</span><span> </span><a name="AppConfig"><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier">AppConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AppConfig"><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier">AppConfig</span></a></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="_baseAppContext"><a href="Nameservice.Config.html#_baseAppContext"><span class="hs-identifier">_baseAppContext</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BaseApp.Context</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_prometheusServerThreadId"><a href="Nameservice.Config.html#_prometheusServerThreadId"><span class="hs-identifier">_prometheusServerThreadId</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ThreadId</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-34"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">AppConfig</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-identifier">makeAppConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier hs-type">AppConfig</span></a><span>
</span><a name="line-37"></a><a name="makeAppConfig"><a href="Nameservice.Config.html#makeAppConfig"><span class="hs-identifier">makeAppConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-38"></a><span>  </span><a name="local-6989586621679139348"><a href="#local-6989586621679139348"><span class="hs-identifier">prometheusEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runMaybeT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-39"></a><span>    </span><a name="local-6989586621679139347"><a href="#local-6989586621679139347"><span class="hs-identifier">prometheusPort</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">read</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">MaybeT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><span class="hs-string">&quot;STATS_PORT&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">P.MetricsScrapingConfig</span><span> </span><a href="#local-6989586621679139347"><span class="hs-identifier hs-var">prometheusPort</span></a><span>
</span><a name="line-41"></a><span>  </span><a name="local-6989586621679139349"><a href="#local-6989586621679139349"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">BaseApp.makeContext</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">KL.InitialLogNamespace</span><span> </span><span class="hs-string">&quot;dev&quot;</span><span> </span><span class="hs-string">&quot;nameservice&quot;</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679139348"><span class="hs-identifier hs-var">prometheusEnv</span></a><span>
</span><a name="line-42"></a><span>  </span><a name="local-6989586621679139350"><a href="#local-6989586621679139350"><span class="hs-identifier">prometheusServer</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-43"></a><span>  </span><a href="Nameservice.Config.html#addScribesToLogEnv"><span class="hs-identifier hs-var">addScribesToLogEnv</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-44"></a><span>    </span><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier hs-var">AppConfig</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_baseAppContext</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679139349"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-45"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_prometheusServerThreadId</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679139350"><span class="hs-identifier hs-var">prometheusServer</span></a><span>
</span><a name="line-46"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-identifier">addScribesToLogEnv</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier hs-type">AppConfig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Nameservice.Config.html#AppConfig"><span class="hs-identifier hs-type">AppConfig</span></a><span>
</span><a name="line-49"></a><a name="addScribesToLogEnv"><a href="Nameservice.Config.html#addScribesToLogEnv"><span class="hs-identifier">addScribesToLogEnv</span></a></a><span> </span><a name="local-6989586621679139351"><a href="#local-6989586621679139351"><span class="hs-identifier">cfg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-50"></a><span>  </span><a name="local-6989586621679139352"><a href="#local-6989586621679139352"><span class="hs-identifier">logLevel</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Nameservice.Config.html#makeLogLevel"><span class="hs-identifier hs-var">makeLogLevel</span></a><span>
</span><a name="line-51"></a><span>  </span><a name="local-6989586621679139353"><a href="#local-6989586621679139353"><span class="hs-identifier">loggingCfg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Nameservice.Config.html#makeLoggingConfig"><span class="hs-identifier hs-var">makeLoggingConfig</span></a><span>
</span><a name="line-52"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679139354"><a href="#local-6989586621679139354"><span class="hs-identifier">initialLogEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><a href="#local-6989586621679139351"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Nameservice.Config.html#baseAppContext"><span class="hs-identifier hs-var">baseAppContext</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BaseApp.contextLogConfig</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">KL.logEnv</span><span>
</span><a name="line-53"></a><span>  </span><a name="local-6989586621679139389"><a href="#local-6989586621679139389"><span class="hs-identifier">scribesLogEnv</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Nameservice.Config.html#makeKatipScribe"><span class="hs-identifier hs-var">makeKatipScribe</span></a><span> </span><a href="#local-6989586621679139353"><span class="hs-identifier hs-var">loggingCfg</span></a><span> </span><a href="#local-6989586621679139352"><span class="hs-identifier hs-var">logLevel</span></a><span> </span><a href="#local-6989586621679139354"><span class="hs-identifier hs-var">initialLogEnv</span></a><span>
</span><a name="line-54"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679139351"><span class="hs-identifier hs-var">cfg</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span>
</span><a name="line-55"></a><span>    </span><a href="Nameservice.Config.html#baseAppContext"><span class="hs-identifier hs-var">baseAppContext</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BaseApp.contextLogConfig</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">KL.logEnv</span><span> </span><span class="hs-operator hs-var">.~</span><span> </span><a href="#local-6989586621679139389"><span class="hs-identifier hs-var">scribesLogEnv</span></a><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">data</span><span> </span><a name="LogLevel"><a href="Nameservice.Config.html#LogLevel"><span class="hs-identifier">LogLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="LogLevel"><a href="Nameservice.Config.html#LogLevel"><span class="hs-identifier">LogLevel</span></a></a><span>
</span><a name="line-60"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="severity"><a href="Nameservice.Config.html#severity"><span class="hs-identifier">severity</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">K.Severity</span><span>
</span><a name="line-61"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="verbosity"><a href="Nameservice.Config.html#verbosity"><span class="hs-identifier">verbosity</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">K.Verbosity</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-identifier">makeLogLevel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Nameservice.Config.html#LogLevel"><span class="hs-identifier hs-type">LogLevel</span></a><span>
</span><a name="line-65"></a><a name="makeLogLevel"><a href="Nameservice.Config.html#makeLogLevel"><span class="hs-identifier">makeLogLevel</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-66"></a><span>  </span><span class="hs-comment">-- LOG_SEVERITY should be in {debug, info, notice, warning, error, critical, alert, emergency}</span><span>
</span><a name="line-67"></a><span>  </span><a name="local-6989586621679143333"><a href="#local-6989586621679143333"><span class="hs-identifier">msev</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><span class="hs-string">&quot;LOG_SEVERITY&quot;</span><span>
</span><a name="line-68"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679143334"><a href="#local-6989586621679143334"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-identifier hs-var">K.InfoS</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679139487"><span class="hs-identifier hs-var">parseSeverity</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679143333"><span class="hs-identifier hs-var">msev</span></a><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-comment">-- LOG_VERBOSITY should be in {0,1,2,3}</span><span>
</span><a name="line-70"></a><span>  </span><a name="local-6989586621679143335"><a href="#local-6989586621679143335"><span class="hs-identifier">mverb</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><span class="hs-string">&quot;LOG_VERBOSITY&quot;</span><span>
</span><a name="line-71"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679143336"><a href="#local-6989586621679143336"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-identifier hs-var">K.V0</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679139488"><span class="hs-identifier hs-var">parseVerbosity</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="#local-6989586621679143335"><span class="hs-identifier hs-var">mverb</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Nameservice.Config.html#LogLevel"><span class="hs-identifier hs-var">LogLevel</span></a><span> </span><span class="hs-special">{</span><span class="hs-identifier">severity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679143334"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">verbosity</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679143336"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">}</span><span>
</span><a name="line-73"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-74"></a><span>    </span><a name="local-6989586621679139487"><a href="#local-6989586621679139487"><span class="hs-identifier">parseSeverity</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">K.textToSeverity</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">cs</span><span>
</span><a name="line-75"></a><span>    </span><a name="local-6989586621679139488"><a href="#local-6989586621679139488"><span class="hs-identifier">parseVerbosity</span></a></a><span> </span><a name="local-6989586621679139489"><a href="#local-6989586621679139489"><span class="hs-identifier">v</span></a></a><span>
</span><a name="line-76"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679139489"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;0&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">K.V0</span><span>
</span><a name="line-77"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679139489"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;1&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">K.V1</span><span>
</span><a name="line-78"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679139489"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;2&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">K.V2</span><span>
</span><a name="line-79"></a><span>      </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679139489"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-string">&quot;3&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier hs-var">K.V3</span><span>
</span><a name="line-80"></a><span>      </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">data</span><span> </span><a name="KatipConfig"><a href="Nameservice.Config.html#KatipConfig"><span class="hs-identifier">KatipConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ES"><a href="Nameservice.Config.html#ES"><span class="hs-identifier">ES</span></a></a><span> </span><span class="hs-special">{</span><a name="host"><a href="Nameservice.Config.html#host"><span class="hs-identifier">host</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a name="port"><a href="Nameservice.Config.html#port"><span class="hs-identifier">port</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="Console"><a href="Nameservice.Config.html#Console"><span class="hs-identifier">Console</span></a></a><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-identifier">makeLoggingConfig</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="Nameservice.Config.html#KatipConfig"><span class="hs-identifier hs-type">KatipConfig</span></a><span>
</span><a name="line-86"></a><a name="makeLoggingConfig"><a href="Nameservice.Config.html#makeLoggingConfig"><span class="hs-identifier">makeLoggingConfig</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-87"></a><span>  </span><a name="local-6989586621679143337"><a href="#local-6989586621679143337"><span class="hs-identifier">mEsConfig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">runMaybeT</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-88"></a><span>    </span><a href="Nameservice.Config.html#ES"><span class="hs-identifier hs-var">ES</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MaybeT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><span class="hs-string">&quot;ES_HOST&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">MaybeT</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookupEnv</span><span> </span><span class="hs-string">&quot;ES_PORT&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><a href="Nameservice.Config.html#Console"><span class="hs-identifier hs-var">Console</span></a><span> </span><a href="#local-6989586621679143337"><span class="hs-identifier hs-var">mEsConfig</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- makes a log environment for console logs / ES logs</span><span>
</span><a name="line-92"></a><span class="hs-identifier">makeKatipScribe</span><span>
</span><a name="line-93"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Nameservice.Config.html#KatipConfig"><span class="hs-identifier hs-type">KatipConfig</span></a><span>
</span><a name="line-94"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Nameservice.Config.html#LogLevel"><span class="hs-identifier hs-type">LogLevel</span></a><span>
</span><a name="line-95"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">K.LogEnv</span><span>
</span><a name="line-96"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">K.LogEnv</span><span>
</span><a name="line-97"></a><a name="makeKatipScribe"><a href="Nameservice.Config.html#makeKatipScribe"><span class="hs-identifier">makeKatipScribe</span></a></a><span> </span><a name="local-6989586621679143338"><a href="#local-6989586621679143338"><span class="hs-identifier">kcfg</span></a></a><span> </span><a href="Nameservice.Config.html#LogLevel"><span class="hs-identifier hs-var">LogLevel</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><a name="local-6989586621679143341"><a href="#local-6989586621679143341"><span class="hs-identifier">le</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679143338"><span class="hs-identifier hs-var">kcfg</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-98"></a><span>  </span><a href="Nameservice.Config.html#Console"><span class="hs-identifier hs-var">Console</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-99"></a><span>    </span><a name="local-6989586621679143564"><a href="#local-6989586621679143564"><span class="hs-identifier">handleScribe</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">K.mkHandleScribe</span><span> </span><span class="hs-identifier hs-var">K.ColorIfTerminal</span><span> </span><span class="hs-identifier hs-var">stdout</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">K.permitItem</span><span> </span><a href="#local-6989586621679143339"><span class="hs-identifier hs-var">severity</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679143340"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier hs-var">K.registerScribe</span><span> </span><span class="hs-string">&quot;stdout&quot;</span><span> </span><a href="#local-6989586621679143564"><span class="hs-identifier hs-var">handleScribe</span></a><span> </span><span class="hs-identifier hs-var">K.defaultScribeSettings</span><span> </span><a href="#local-6989586621679143341"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-101"></a><span>  </span><a href="Nameservice.Config.html#ES"><span class="hs-identifier hs-var">ES</span></a><span> </span><span class="hs-special">{</span><a name="local-6989586621679143565"><a href="#local-6989586621679143565"><span class="hs-identifier">host</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679143566"><a href="#local-6989586621679143566"><span class="hs-identifier">port</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-102"></a><span>    </span><a name="local-6989586621679143672"><a href="#local-6989586621679143672"><span class="hs-identifier">mgr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Client.newManager</span><span> </span><span class="hs-identifier hs-var">Client.defaultManagerSettings</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679143673"><a href="#local-6989586621679143673"><span class="hs-identifier">serverAddress</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;http://&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679143565"><span class="hs-identifier hs-var">host</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679143566"><span class="hs-identifier hs-var">port</span></a><span>
</span><a name="line-104"></a><span>        </span><a name="local-6989586621679143674"><a href="#local-6989586621679143674"><span class="hs-identifier">bloodhoundEnv</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BH.mkBHEnv</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BH.Server</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">cs</span><span> </span><a href="#local-6989586621679143673"><span class="hs-identifier hs-var">serverAddress</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679143672"><span class="hs-identifier hs-var">mgr</span></a><span>
</span><a name="line-105"></a><span>    </span><a name="local-6989586621679154777"><a href="#local-6989586621679154777"><span class="hs-identifier">esScribe</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ES.mkEsScribe</span><span> </span><span class="hs-identifier hs-var">ES.defaultEsScribeCfgV5</span><span> </span><a href="#local-6989586621679143674"><span class="hs-identifier hs-var">bloodhoundEnv</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BH.IndexName</span><span> </span><span class="hs-string">&quot;nameservice&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">BH.MappingName</span><span> </span><span class="hs-string">&quot;application-logs&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">K.permitItem</span><span> </span><a href="#local-6989586621679143339"><span class="hs-identifier hs-var">severity</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679143340"><span class="hs-identifier hs-var">verbosity</span></a><span>
</span><a name="line-107"></a><span>    </span><span class="hs-identifier hs-var">K.registerScribe</span><span> </span><span class="hs-string">&quot;es&quot;</span><span> </span><a href="#local-6989586621679154777"><span class="hs-identifier hs-var">esScribe</span></a><span> </span><span class="hs-identifier hs-var">K.defaultScribeSettings</span><span> </span><a href="#local-6989586621679143341"><span class="hs-identifier hs-var">le</span></a><span>
</span><a name="line-108"></a></pre></body></html>